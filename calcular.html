<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Punto de equilibrio</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="./style.css" rel="stylesheet">
  <link rel="icon" href="balance.svg" type="image/x-icon">
</head>
<body id="calcular_body">
  <header>
    Punto de Equilibrio
  </header>
  <main>
    <h2 id="titulo">Calcula el punto de equilibrio</h2>
    <label for="costosFijos">Costos Fijos ($):</label>
    <input type="number" id="costosFijos" placeholder="Ejemplo: 5000" inputmode="decimal" pattern="^[0-9]+(\.[0-9]+)?$">

    <label for="costoVariable">Costo Variable por Unidad ($):</label>
    <input type="number" id="costoVariable" placeholder="Ejemplo: 20" inputmode="decimal" pattern="^[0-9]+(\.[0-9]+)?$">

    <label for="precioVenta">Precio de Venta por Unidad ($):</label>
    <input type="number" id="precioVenta" placeholder="Ejemplo: 50" inputmode="decimal" pattern="^[0-9]+(\.[0-9]+)?$">

    <label for="ventas">Unidades Vendidas:</label>
    <input type="number" id="ventas" placeholder="Ejemplo: 300" inputmode="decimal" pattern="^[0-9]+(\.[0-9]+)?$">

    <button class="calcular" onclick="calcular()">Calcular</button>
    <a href="index.html" class="calcular">Regresar</a>

    <div id="resultado"></div>
    <canvas id="grafica"></canvas>
  </main>

  <script>
    let chart;

    function calcular() {
      const costosFijos = parseFloat(document.getElementById("costosFijos").value);
      const costoVariable = parseFloat(document.getElementById("costoVariable").value);
      const precioVenta = parseFloat(document.getElementById("precioVenta").value);
      const ventas = parseFloat(document.getElementById("ventas").value);

      if (isNaN(costosFijos) || isNaN(costoVariable) || isNaN(precioVenta) || isNaN(ventas)) {
        alert("Por favor ingresa todos los valores.");
        return;
      }

      const contribucion = precioVenta - costoVariable;
      const puntoEquilibrio = Math.ceil(costosFijos / contribucion);
      const ingresos = ventas * precioVenta;
      const costosTotales = costosFijos + (ventas * costoVariable);
      const utilidad = ingresos - costosTotales;

      let resultadoTexto = `
        Punto de equilibrio: ${puntoEquilibrio.toFixed(2)} unidades<br>
        Ingresos: $${ingresos.toFixed(2)}<br>
        Costos Totales: $${costosTotales.toFixed(2)}<br>
        Utilidad: $${utilidad.toFixed(2)}<br>
      `;

      if (utilidad > 0) {
        resultadoTexto += '<span style="color:rgb(50, 205, 50)">La empresa es rentable</span>';
      } else if (utilidad < 0) {
        resultadoTexto += '<span style="color:rgb(220, 20, 60)">La empresa NO es rentable</span>';
      } else {
        resultadoTexto += '<span style="color:rgb(147, 112, 219)">La empresa está en el punto de equilibrio ⚖</span>';
      }

      document.getElementById("resultado").innerHTML = resultadoTexto;

      // Gráfica
      const ctx = document.getElementById("grafica").getContext("2d");
      if (chart) chart.destroy();

      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: Array.from({length: ventas+20}, (_, i) => i),
          datasets: [
            {
              label: 'Ingresos',
              data: Array.from({length: ventas+20}, (_, i) => i * precioVenta),
              borderColor: 'rgb(50, 205, 50)',
              borderWidth: 2,
              fill: false
            },
            {
              label: 'Costos Totales',
              data: Array.from({length: ventas+20}, (_, i) => costosFijos + (i * costoVariable)),
              borderColor: 'rgb(220, 20, 60)',
              borderWidth: 2,
              fill: false
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'top' }
          },
          scales: {
            x: {
              title: {
              display: true,
              text: "Unidades",
              color: "black" 
              },
              ticks: {
                color: "black" 
              },
              grid: {
                color: "black" 
              }
            },
            y: {
              title: {
                display: true,
                text: "Dinero ($)",
                color: "black"
              },
              ticks: {
                color: "black" 
              },
              grid: {
                color: "black"
              }
            }
          }
        }
      });
    }
  </script>
</body>
</html>