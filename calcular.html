<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Punto de equilibrio</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="./style.css" rel="stylesheet">
  <link rel="icon" href="balance.svg" type="image/x-icon">
</head>
<body>
  <header>
    Punto de Equilibrio
  </header>
  <main>
    <h2>Calcula el punto de equilibrio</h2>
    <label for="costosFijos">Costos Fijos ($):</label>
    <input type="number" id="costosFijos" placeholder="Ejemplo: 5000">

    <label for="costoVariable">Costo Variable por Unidad ($):</label>
    <input type="number" id="costoVariable" placeholder="Ejemplo: 20">

    <label for="precioVenta">Precio de Venta por Unidad ($):</label>
    <input type="number" id="precioVenta" placeholder="Ejemplo: 50">

    <label for="ventas">Unidades Vendidas:</label>
    <input type="number" id="ventas" placeholder="Ejemplo: 300">

    <button id="calcular" onclick="calcular()">Calcular</button>

    <div id="resultado"></div>
    <canvas id="grafica"></canvas>
  </main>

  <script>
    let chart;

    function calcular() {
      const costosFijos = parseFloat(document.getElementById("costosFijos").value);
      const costoVariable = parseFloat(document.getElementById("costoVariable").value);
      const precioVenta = parseFloat(document.getElementById("precioVenta").value);
      const ventas = parseFloat(document.getElementById("ventas").value);

      if (isNaN(costosFijos) || isNaN(costoVariable) || isNaN(precioVenta) || isNaN(ventas)) {
        alert("Por favor ingresa todos los valores.");
        return;
      }

      const contribucion = precioVenta - costoVariable;
      const puntoEquilibrio = costosFijos / contribucion;
      const ingresos = ventas * precioVenta;
      const costosTotales = costosFijos + (ventas * costoVariable);
      const utilidad = ingresos - costosTotales;

      let resultadoTexto = `
        Punto de equilibrio: ${puntoEquilibrio.toFixed(2)} unidades<br>
        Ingresos: $${ingresos.toFixed(2)}<br>
        Costos Totales: $${costosTotales.toFixed(2)}<br>
        Utilidad: $${utilidad.toFixed(2)}<br>
      `;

      if (utilidad > 0) {
        resultadoTexto += '<span style="color:green">La empresa es rentable</span>';
      } else if (utilidad < 0) {
        resultadoTexto += '<span style="color:red">La empresa NO es rentable</span>';
      } else {
        resultadoTexto += '<span style="color:orange">La empresa está en el punto de equilibrio ⚖</span>';
      }

      document.getElementById("resultado").innerHTML = resultadoTexto;

      // Gráfica
      const ctx = document.getElementById("grafica").getContext("2d");
      if (chart) chart.destroy();

      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: Array.from({length: ventas+20}, (_, i) => i),
          datasets: [
            {
              label: 'Ingresos',
              data: Array.from({length: ventas+20}, (_, i) => i * precioVenta),
              borderColor: 'green',
              borderWidth: 2,
              fill: false
            },
            {
              label: 'Costos Totales',
              data: Array.from({length: ventas+20}, (_, i) => costosFijos + (i * costoVariable)),
              borderColor: 'red',
              borderWidth: 2,
              fill: false
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'top' }
          },
          scales: {
            x: { title: { display: true, text: "Unidades" } },
            y: { title: { display: true, text: "Dinero ($)" } }
          }
        }
      });
    }
  </script>
</body>
</html>